# 2026-02-09

## 1. Solid Plugin Node.js Runtime + Host Framework Selector

**Timestamp:** 2026-02-09
**Topic:** Adding Node.js (WebSocket) runtime support for Solid plugins and framework selector UI

### Options Considered
- **Run .client.ts source directly with Bun** (like React plugins do) — rejected because Bun can't natively run Solid's universal JSX transform; the Babel + `babel-preset-solid` + `generate: "universal"` pipeline must run first.
- **Build client entries with `target: "bun"`** — chosen; Bun.build handles the Babel transform via plugin, then the built JS is executed by Bun at runtime.

### Final Decision & Rationale
Client entries (`simple-demo.client.ts`, `advanced-demo.client.ts`) are built alongside worker entries in `build.ts`, using `target: "bun"` with the same `solidTransformPlugin`. The `dev:all:solid` orchestration script builds first, then starts bridge + clients + Svelte host in parallel.

### Key Changes Made
- **Created** `examples/plugin-solid-example/src/simple-demo.client.ts` and `advanced-demo.client.ts` — WebSocket client entries using `createSolidWebSocketPluginClient()` with `solid-` prefixed plugin IDs.
- **Modified** `examples/plugin-solid-example/build.ts` — added `clientEntrypoints` array built with `target: "bun"`.
- **Modified** `examples/plugin-solid-example/package.json` — added `client`, `client:simple`, `client:advanced` scripts.
- **Modified** `examples/bridge-server/src/index.ts` — added `GET /solid/:filename` route serving from `plugin-solid-example/dist/`.
- **Modified** `examples/host-svelte-demo/package.json` — added `dev:all:solid` and `solid-plugins:wait` (with build step before client launch).
- **Modified** `examples/host-svelte-demo/src/routes/+page.svelte` — added React/Solid framework selector, conditional worker URLs (`/solid/` prefix), plugin IDs (`solid-` prefix), disabled main-thread for Solid.

### Future Considerations
- The `solid-plugins:wait` script runs a full build before launching clients. This adds startup latency vs React's `dev:all` which assumes pre-built plugins. A watch-mode alternative could improve DX.

---

## 2. Fix: Solid Plugin Node.js Mode Reactivity Bug

**Timestamp:** 2026-02-09
**Topic:** Solid plugins completely non-reactive in Node.js (WebSocket) mode — buttons, inputs, toggles all non-functional

### Root Cause
`Bun.build({ target: "bun" })` resolves `solid-js` using the `"node"` export condition, which maps to `solid-js/dist/server.js` — the SSR stub. In this version:
- `createSignal` returns a plain closure (no reactive tracking)
- `createRenderEffect` (aliased to `createComputed`) runs once synchronously, never re-executes on signal changes

The worker build uses `target: "browser"` which resolves to `solid-js/dist/dev.js` with full reactivity.

**Evidence:**
- Client bundle comment: `solid-js@1.9.11/.../dist/server.js`
- Worker bundle comment: `solid-js@1.9.11/.../dist/dev.js`

### Options Considered
1. **Switch client target to `"browser"`** — rejected; would add unnecessary browser polyfills (Buffer, etc.) and break Bun-native APIs used by kkrpc WebSocket transport.
2. **Mark `solid-js` as external** — rejected; at runtime Bun would still resolve to server.js via the `"node"` condition.
3. **Add `conditions: ["browser"]` to client build** — chosen; tells Bun's resolver to prefer the `"browser"` export condition, getting the reactive version while keeping `target: "bun"` for everything else.

### Final Decision & Rationale
One-line fix: add `conditions: ["browser"]` to the `Bun.build()` config for client entrypoints. This is the minimal, targeted fix — it overrides only the export condition resolution without changing the target environment or bundling strategy.

### Key Changes Made
- **Modified** `examples/plugin-solid-example/build.ts` — added `conditions: ["browser"]` to client build config.

### Future Considerations
- Any future runtime package targeting Bun/Node that depends on `solid-js` will need the same `conditions: ["browser"]` override. This is a fundamental constraint of Solid's package exports: the `"node"` condition maps to the non-reactive SSR build.
- Consider documenting this in CLAUDE.md as an anti-pattern: "NEVER build Solid client entries with `target: 'bun'` without `conditions: ['browser']`."
